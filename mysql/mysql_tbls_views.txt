set character_set_client=utf8;
set character_set_connection=utf8;
set character_set_database=utf8;
set character_set_results=utf8;
set character_set_server=utf8;

CREATE USER eojapp IDENTIFIED BY 'ecust';

CREATE DATABASE eojdb;
GRANT all privileges on eojdb.* 
TO eojapp@'%';

#firstly,it should have one user which named anonymous
CREATE TABLE uploader
(
  uploader_id INT UNSIGNED PRIMARY KEY auto_increment,
  user_name VARCHAR(20) NOT NULL,
  user_passwd CHAR(32) DEFAULT 'e10adc3949ba59abbe56e057f20f883e' NOT NULL,
  user_info VARCHAR(128),
  user_privis TINYINT UNSIGNED DEFAULT 0 NOT NULL
) ENGINE=INNODB;


CREATE TABLE uploadit
(
  up_id INT UNSIGNED auto_increment PRIMARY KEY,
  uploader_id INT UNSIGNED NOT NULL,
  p_title VARCHAR(128) DEFAULT '无标题',
  p_desc TEXT CHARACTER SET utf8,
  p_lang VARCHAR(20) DEFAULT '中文',
  p_tlimt SMALLINT UNSIGNED,
  p_mlimt SMALLINT UNSIGNED,
  p_input_tips VARCHAR(1024), 
  p_output_tips VARCHAR(1024),
  p_sampleinput VARCHAR(1024),
  p_sampleoutput VARCHAR(1024),
  handout_status TINYINT UNSIGNED,
  up_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY(uploader_id) references uploader(uploader_id)
) ENGINE=INNODB;


CREATE TABLE problem
(
  p_id INT UNSIGNED auto_increment,
  p_title VARCHAR(128) DEFAULT '无标题',
  p_desc TEXT CHARACTER SET utf8,
  p_lang VARCHAR(20) DEFAULT '中文',
  p_tlimt SMALLINT UNSIGNED,
  p_mlimt SMALLINT UNSIGNED,
  p_tsubmit INT UNSIGNED,
  p_acc INT UNSIGNED,
  p_input_tips VARCHAR(1024), 
  p_output_tips VARCHAR(1024),
  p_sampleinput VARCHAR(1024),
  p_sampleoutput VARCHAR(1024),
  p_hint VARCHAR(1024),
  p_create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  p_author INT UNSIGNED,
  PRIMARY KEY(p_id),
  FOREIGN KEY(p_author) references uploader(uploader_id)
) ENGINE=INNODB;


CREATE TABLE eojuser
(
  user_id INT UNSIGNED auto_increment,
  user_name VARCHAR(20) NOT NULL,
  user_passwd CHAR(32) DEFAULT 'e10adc3949ba59abbe56e057f20f883e',
  user_tsubmit INT UNSIGNED DEFAULT 0,
  user_acc INT UNSIGNED DEFAULT 0,
  PRIMARY KEY(user_id)
) ENGINE=INNODB;


CREATE TABLE answerit
(
  ans_id INT UNSIGNED auto_increment,
  ans_uid INT UNSIGNED,
  ans_pid INT UNSIGNED,
  ans_submitt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  ans_mcost SMALLINT UNSIGNED,
  ans_tcost SMALLINT UNSIGNED,
  ans_codeloc VARCHAR(256),
  ans_codetype TINYINT UNSIGNED,
  ans_codel SMALLINT UNSIGNED,
  ans_result SMALLINT,
  PRIMARY KEY(ans_id),
  FOREIGN KEY(ans_uid) references eojuser(user_id),
  FOREIGN KEY(ans_pid) references problem(p_id)
) ENGINE=INNODB;


CREATE TABLE EOJLOG
(
  log_id BIGINT UNSIGNED auto_increment PRIMARY KEY,
  log_genetime TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  oper_userid INT UNSIGNED,
  opcode TINYINT UNSIGNED,
  op_result TINYINT UNSIGNED
) ENGINE=MYISAM;